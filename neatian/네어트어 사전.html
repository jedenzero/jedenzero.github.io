<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
	  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <title>네어트어</title>
      <link rel="stylesheet" href="../grayblue.css">
  </head>
  <body>
    <div class="header">
      <a style="margin-left:20px;color:#1D2F52;font-size:15px;" href="https://jedenzero.github.io/neatian/">NEĂTĂK</a>
    </div>
    <div class="contain" style="width:260px;">
    <p id="total_amount"></p>
    <div class="underline">
      <input type="text" id="search" onkeyup="search()">
    </div>
    <p id="search_amount"></p>
    <div id="output"></div>
    </div>
    <div id="floating">
      <h2 style="text-align:center;">범위 제한</h2>
      <h3>품사</h3>
      <div class="limit" onclick="limit(this)">명사</div>
      <div class="limit" onclick="limit(this)">동사</div>
      <div class="limit" onclick="limit(this)">조사</div>
      <div class="limit" onclick="limit(this)">부사</div>
      <div class="limit" onclick="limit(this)">접속사</div>
      <div class="limit" onclick="limit(this)">전접사</div>
      <div class="limit" onclick="limit(this)">후접사</div>
      <div class="limit" onclick="limit(this)">접두사</div>
      <div class="limit" onclick="limit(this)">접미사</div>
      <h3>세부 분류</h3>
      <div class="timil" onclick="timil(this)">초기 네어트어</div>
      <div class="limit" onclick="timil(this)">민중 네어트어</div>
      <div class="timil" onclick="timil(this)">예타뷔스 방언</div>
      <div style="text-align:center;margin-top:10px;">
        <i class="fi fi-br-cross" onclick="visible()"></i>
      </div>
    </div>
    <div id="gnitaolf" onclick="visible()">
      <i class="fi fi-br-bars-filter"></i>
    </div>
  </body>
  <script>
    const input = document.getElementById('search');
    const output = document.getElementById('output');
    const totalAmount = document.getElementById('total_amount');
    const searchAmount = document.getElementById('search_amount');
    const fl = document.getElementById('floating');
    const lf = document.getElementById('gnitaolf');
    const limitarr = [];
    const timilarr = [];
    const partColors = {"명사":0, "동사":0, "조사":0, "부사":0, "접속사":0, "전접사":0, "후접사":0, "접두사":0, "접미사":0};
    const detailColors = {"초기 네어트어":1, "민중 네어트어":0, "예타뷔스 방언":1};
    const detailCodes = {"초기 네어트어":"γo", "민중 네어트어":"ze", "예타뷔스 방언":"je"};
    const detailNames = Object.entries(detailCodes).reduce((acc, [key, value]) => ({...acc, [value]: key}), {});
    let variable = 0;
    
    function search() {
      const keyword = input.value;

      fetch('https://sheets.googleapis.com/v4/spreadsheets/13LICoyhYt4Do9R24ktfoDpSDFxhHKpO-r44P3ROTJZQ/values/ne!A:D?key=AIzaSyATLeHQh6kM0LWRJjLg8CmzoSdnntFrmFk')
      .then(response => response.json())
      .then(data => {
        let Match = data.values.filter(row=>row[0].includes(keyword)||row[2].includes(keyword));
        Match = Match.filter(row=>!limitarr.includes(row[1]));
        Match = Match.filter(row=>!timilarr.includes(row[3]));
        
        let exactMatch = Match.filter(row=>row[0]===(keyword)||row[2].split(', ').includes(keyword));
        let startMatch = Match.filter(row=>row[0].startsWith(keyword)&&row[0]!==keyword);
        let otherMatch = Match.filter(row=>!exactMatch.includes(row)&&!startMatch.includes(row));

        totalAmount.innerHTML = '현재 총 단어수 : '+data.values.length+'개'
        searchAmount.innerHTML = '검색 결과 : '+Match.length+'개'
        output.innerHTML = '';
        
        exactMatch.forEach((row, index)=>createWordElement(index+1,row));
        startMatch.forEach ((row, index)=>createWordElement(index+1+exactMatch.length,row));
        otherMatch.forEach((row, index)=>createWordElement(index+1+exactMatch.length+startMatch.length,row));
        
        function createWordElement(id,data) {
          const div=document.createElement('div');
          div.className='word';
          div.innerHTML+='<sup>'+id+'</sup>'+'<h2 style="display:inline-block;margin-bottom:0;"><b>'+data[0]+'</b></h2>';
          div.innerHTML+='<p>'+data[1]+'<br>';
          if (data[3]!=="ze"){
            div.innerHTML+='['+detailNames[data[3]]+'] '
          }
          div.innerHTML+=data[2]+'</p>';
          output.appendChild (div);
         }
      })
      .catch(error => console.error('Error:', error));
    }
    function limit(element){
      if (partColors[element.innerText]===0){
        element.style.backgroundColor="#F5F5F5";
        element.style.color="#374052";
        limitarr.push(element.innerText);
      }
      else{
        element.style.backgroundColor="#1D2F52";
        element.style.color="#F5F5F5";
        limitarr.splice(limitarr.indexOf(element.innerText),1);
      }
      partColors[element.innerText]=1-partColors[element.innerText];
      search();
    }
    function timil(element){
      if (detailColors[element.innerText]===0){
        element.style.backgroundColor="#F5F5F5";
        element.style.color="#374052";
        timilarr.push(detailCodes[element.innerText]);
      }
      else{
        element.style.backgroundColor="#1D2F52";
        element.style.color="#F5F5F5";
        timilarr.splice(timilarr.indexOf(detailCodes[element.innerText]),1);
      }
      detailColors[element.innerText]=1-detailColors[element.innerText];
      search();
    }
    function visible(){
      if (variable===0){
        fl.style.visibility="hidden";
        lf.style.visibility="visible";
      }
      else{
        fl.style.visibility="visible";
        lf.style.visibility="hidden";
      }
      variable=1-variable;
    }
    search();
    visible();
  </script>
</html>
